<template>  <PClayoutJp>    <BannerPc />    <PCTabList/>    <img class="img" src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/Japanese/list/bg2.jpg" alt="" />    <div class="text-content">      <div class="text-wrap">        <div class="text-title" v-if="details && details.title">{{ details.title }}</div>        <p class="time" v-if="isShow.includes($route.query.tab)">{{ details.publishTime }}</p>        <div class="text" v-if="details.content" v-html="detailsComputed(details.content)"></div>        <div v-if="details.videoInfo" class="video-wrap">          <video :src="details.videoInfo.url" controls :poster="details.videoInfo.imgUrl"></video>        </div>        <div v-if="details.channelName && details.channelName.includes('熊猫音乐')" class="xmyy-audio">          <AudioBox            v-if="details.audioInfo1 && details.audioInfo1.length && details.audioInfo1[0]"            :src="audioObj ? audioObj.url : ''"            :title="audioObj ? audioObj.name : ''"            :palyIndex="audioIndex"            :details="details"            @audioClick="audioClick"          />        </div>        <!--<div v-if="!details.content && noData" class="no-data">          <img src="https://file.daqsoft.com/uploadfile/server/geekui/panad/01065f5c-b833-4a97-ad2b-404a2e506fc0.gif" alt="" />        </div>-->        <div class="small-box">          <img src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/Japanese/list/small-panda.png"               class="small-panda" alt="" :class="{'fix-class': fixClass}" />          <span class="trans-box"></span>        </div>      </div>    </div>  </PClayoutJp></template><script>import BannerPc from '@/views/Japanese/components/BannerPc.vue'import PCTabList from '@/views/Japanese/components/PCTabList.vue'import AudioBox from '@/components/PCComponents/AudioBox.vue'import { getDetail, getSimplifyList } from '@/service/apiList/common'export default {  name: 'listIndex',  components: {    BannerPc,    PCTabList,    AudioBox  },  data () {    return {      details: {},      fixClass: false,      noData: false,      audioObj: {},      audioIndex: 0,      isShow: ['zxxw', 'sj', 'xmyw', 'xmhd', 'ywsd', 'kpdt'],    }  },  computed: {    detailsComputed () {      return (content) => {        try {          let str = content          let reg = /(\d+)+(?=rem\b)|(\d+\.)\d+(?=rem\b)/g          let arr = str.match(reg)          if(arr && arr.length) {            for(let i = 0; i < arr.length; i++) {              str = str.replace(arr[i], arr[i] / 2)            }          }          str = str.replaceAll('text-indent: 2em;', 'text-indent: 1em;')          return str        } catch (error) {          return content        }      }    },    strIntercept() {      return (item) => {        try {          return item.includes('（') ? item.substring(0, item.indexOf('（')) : item        } catch (error) {          return item        }      }    }  },  mounted () {    window.addEventListener('scroll', this.handleScroll, true)  },  beforeDestroy () {    window.removeEventListener('scroll', this.handleScroll, true)  },  watch: {    $route: {      handler(to) {        // 列表过来的        if (to.query.id) {          this.getDetails(to.query.id)        } else {          // 详情过来的          getSimplifyList({            channelCode: to.query.tab,          }).then((res) => {            if (res.code === 0) {              try {                this.getDetails(res.datas[0].id || '')              } catch (error) {                this.details = {}                this.noData = true              }            }          })        }      },      immediate: true,      deep: true,    },  },  methods: {    itemClick(item, index) {      this.currentIndex = index    },    getDetails(id) {      this.noData = false      getDetail({ id }).then(res => {        if (res.code === 0) {          this.details = res.data          this.audioObj = this.details.audioInfo1 ? this.details.audioInfo1[0] : {}          document.title = this.strIntercept(res.data.title)        }      }).finally(() => {        this.noData = true      })    },    handleScroll() {      let scrolltop = document.querySelector('.trans-box') ? document.querySelector('.trans-box').getBoundingClientRect().top : ''      let height = document.querySelector('.header-wrap').offsetHeight      if(scrolltop <= height) {        if(!this.fixClass) {          this.fixClass = true        }      } else {        if(this.fixClass) {          this.fixClass = false        }      }    },    audioClick(item, index) {      this.audioObj = item      this.audioIndex = index    },  }}</script><style lang="scss" scoped>.img {  width: 100%;  height: calc(100vh - 1.2rem);  position: sticky;  top: 1.2rem;  left: 0;  z-index: -1;}.text-content {  position: relative;  margin-top: calc(-100vh + 1.2rem);  left: 0;}.text-wrap {  width: 13.6rem;  margin: auto;  top: -0.8rem;  position: relative;  background: #ffffff;  min-height: 6rem;  padding: .6rem;  .text-title {    font-size: 0.4rem;    line-height: 0.6rem;    margin-bottom: 0.2rem;    font-weight: bold;  }  .time {    text-align: right;  }  .text {    margin-top: .4rem;    width: 100%;    font-family: 'Microsoft YaHei', Arial, Helvetica, sans-serif;    line-height: .3rem;  }  .video-wrap {    text-align: center;    margin-top: .4rem;    video {      width: 100%;      margin: auto;      object-fit: cover;    }  }  .no-data {    width: 4rem;    margin: auto;    padding-top: 1rem;    img {      width: 100%;    }  }  .small-box {    margin-top: .4rem;    .small-panda {      position: absolute;      width: .58rem;      display: inline-flex;      top: 3.96rem;      right: -0.32rem;      z-index: -1;    }    .fix-class {      position: fixed;      top: 1.2rem;      right: 2.46rem;    }    .trans-box {      position: absolute;      width: .01rem;      height: .01rem;      display: inline-flex;      top: 3.96rem;      right: -0.32rem;      z-index: -1;      opacity: 0;    }  }}</style>