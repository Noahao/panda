<template>  <div class="list-wrap">    <div v-if="list.length && params.channelCode !== 'dxmkpzs'">      <div v-for="(item, index) in list" :key="index" class="list-box" @click="item.contentType === 'IMAGE' ? '' : jumpDetails(item)">        <div class="img">          <img :src="setUrl(item) || $Placeholder" alt="" />        </div>        <template v-if="item.contentType === 'IMAGE'">          <div class="xmgxc">            <img :preview="index" :src="item2.url" :large="item2.url" v-for="item2 in item.imageUrls" :key="item2.id" />          </div>        </template>        <p class="title">{{ item.title }}</p>        <p class="summary">{{ getDesc(item.summary) }}</p>        <p class="time" v-if="isShow.includes(params.channelCode)">{{ item.publishTime }}</p>      </div>    </div>    <div v-else>      <div v-for="(item, index) in list" :key="index" class="list-box dxmkpzs-list" @click="item.contentType === 'IMAGE' ? '' : jumpDetails(item)">        <p class="title">{{ item.title }}</p>        <p class="summary">{{ getDesc(item.summary) }}</p>      </div>    </div>    <!-- 点击加载 -->    <!--<template v-if="list.length">      <div class="paging" v-show="params.currPage < totalPage && !isSkeleton">        <div @click="page(1)">クリックして追加ロ`ド</div>      </div>      <div class="paging" v-show="params.currPage === totalPage && !isSkeleton">        <div>これ以上のデ`タはありません</div>      </div>    </template>-->    <!--<div v-if="!list.length && !isSkeleton" class="no-data">      <img src="https://file.daqsoft.com/uploadfile/server/geekui/panad/01065f5c-b833-4a97-ad2b-404a2e506fc0.gif" alt="" />    </div>-->    <!-- 骨架屏 -->  </div></template><script>import { getSimplifyList } from '@/service/apiList/common'export default {  name: 'listCom',  components: {  },  props: {    channelCode: {      type: String,      default: ''    }  },  data() {    return {      list: [],      isSkeleton: false,      params: {        channelCode: '',        pageSize: 5,        currPage: 1,      },      totalPage: 0,      noMore: false,      isShow: ['zxxw', 'sj', 'xmyw', 'xmhd', 'ywsd', 'kpdt']    }  },  computed: {    setUrl() {      return (item) => {        try {          if (item.contentType === 'IMAGE') {            return item.imageUrls[0].url          }          if (item.video) {            return item.video.imgUrl          }          return item.cover        } catch (error) {          return item.cover        }      }    },    strIntercept() {      return (item) => {        try {          return item.substring(0, item.indexOf('（'))        } catch (error) {          return item        }      }    },    getDesc() {      return (desc) => {        let reg = /\s+/g        let trimStr = desc.replace(reg,'')        return trimStr      }    }  },  watch: {    channelCode: {      handler(val) {        this.params.channelCode = val        this.params.currPage = 1        this.totalPage = 0        this.list = []        val ? this.getList() : ''      },      immediate: true,      deep: true,    },  },  mounted() {    /**     * [滚动加载]     */    window.addEventListener('scroll', this.scrollHander)  },  methods: {    getList() {      this.isSkeleton = true      getSimplifyList(this.params).then(res => {        if (res.code === 0) {          try {            this.totalPage = res.page.totalPage            document.title = this.strIntercept(res.datas[0].channelName)            if (this.params.currPage === 1) {              this.list = res.datas            } else {              this.list.push(...res.datas)            }          } catch (error) {            this.list = []            return ''          }        }      }).finally(() => {        this.isSkeleton = false        this.$previewRefresh()      })    },    page(num) {      this.params.currPage += num      this.getList()    },    // 跳转详情    jumpDetails(item) {      this.$router.push({        path: '/h5/details',        query: {          channelCode: this.$route.query.channelCode,          id: item.id,          tab: this.params.channelCode,        },      })    },    /**     * [获取滚动条当前的位置]     * @return {[Number]} [scrollTop]     */    getScrollTop () {      let scrollTop = 0      if (document.documentElement && document.documentElement.scrollTop) {        scrollTop = document.documentElement.scrollTop      } else if (document.body) {        scrollTop = document.body.scrollTop      }      return scrollTop    },    /**     * [获取当前可视范围的高度]     * @return {[Number]} [clientHeight]     */    getClientHeight () {      let clientHeight = 0      if (document.body.clientHeight && document.documentElement.clientHeight) {        clientHeight = Math.min(          document.body.clientHeight,          document.documentElement.clientHeight        )      } else {        clientHeight = Math.max(          document.body.clientHeight,          document.documentElement.clientHeight        )      }      return clientHeight    },    /**     * [获取当前可视范围的高度]     * @return {[Number]} [clientHeight]     */    getScrollHeight () {      return Math.max(        document.body.scrollHeight,        document.documentElement.scrollHeight      )    },    scrollHander () {      // 华为p40滚动加载有问题 把这个高度加高了一点 以前是120      // 判断是否到达可滚动加载      if (        this.getScrollTop() + this.getClientHeight() + 160 >=        this.getScrollHeight()      ) {        if (this.totalPage <= this.params.currPage) {          this.noMore = true        } else {          this.params.currPage++          this.getList()        }      }    }  }}</script><style lang="scss" scoped>.list-wrap {  padding: 0 .4rem 0.8rem;  .list-box {    width: 100%;    margin-bottom: .49rem;    position: relative;    .img {      width: 100%;      img {        width: 100%;      }    }    .title {      color: #333333;      font-size: .24rem;      margin: .3rem 0;      @include ellipsisLn(2);      font-weight: bold;    }    .summary {      color: #666666;      font-size: .2rem;      text-indent: 1em;    }    .time {      margin: 0.3rem 0 0;      color: #666666;      font-size: .2rem;    }    .xmgxc {      position: absolute;      top: 0;      opacity: 0;      z-index: 10;      height: 100%;      width: 100%;      overflow: hidden;      img {        width: 100%;        height: 100%;      }    }  }  .dxmkpzs-list {    padding: 0.4rem 0.2rem;    background: rgb(245,245,245);    .title {      color: #333333;      font-size: .26rem;      margin: 0 0 .3rem;      font-weight: bold;      @include ellipsisLn(2);    }    .summary {      color: #666666;      font-size: .2rem;      text-indent: 1em;    }  }  .no-data {    width: 4rem;    margin: auto;    position: relative;    z-index: 10;    img {      width: 100%;    }  }  .paging {    margin: auto;    display: flex;    justify-content: space-around;    color: #666;    div {      font-weight: 500;      font-size: 0.24rem;      padding: 0.14rem 0.4rem;      line-height: 1;      border-radius: 0.26rem;      border: 0.01rem solid #d8d8d8;    }  }}</style>