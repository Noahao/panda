<template>  <PCLayout>    <PCBanner :channelCode="channelCode" />    <div class="content">      <div class="main">        <div v-if="details.content || details.channelName === '视频'">          <div class="box">            <div class="title">              {{ details.title }}            </div>            <div class="nav" v-if="isShow.includes(channelCode) || channelName.includes(details.channelName)">              <span class="img">                <img src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/baseDynamicList/img02.png" alt="" />              </span>              <p class="createCompanyName">{{ details.createCompanyName }}</p>              <span style="font-weight: bold;">・</span>              <p class="time">{{ details.publishTime }}</p>            </div>          </div>          <div class="video" v-if="details.contentType === 'VIDEO'">            <video controls :src="details.videoInfo.url"></video>          </div>          <div class="text" v-else>            <div v-if="details.channelName === '熊猫美术馆' && details.imageUrls.length" class="xmmsg-swiper">              <div class="big-picture">                <img :src="getUrl(imgUrl)" alt="" />                <p class="name">{{ getName(imgUrl.name) }}</p>              </div>              <div class="swiper-wrap">                <swiper :options="linkSwiperOptions">                  <swiper-slide v-for="(item, index) in details.imageUrls" :key="index">                    <div class="img-wrap" @click="imgClick(item, index)" :class="{active: currentIndex === index}">                      <div class="img-box">                        <img class="cloud-img" :src="getUrl(item)"/>                      </div>                    </div>                  </swiper-slide>                </swiper>                <div class="swiper-button btn-left" v-if="details.imageUrls.length > 4">                  <img src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/education/left.png" alt="" />                </div>                <div class="swiper-button btn-right" v-if="details.imageUrls.length > 4">                  <img src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/education/right.png" alt="" />                </div>              </div>            </div>            <div v-html="detailsComputed"></div>            <div v-if="details.channelName === '熊猫音乐'" class="xmyy-audio">              <AudioBox                v-if="details.audioInfo1 && details.audioInfo1.length && details.audioInfo1[0]"                :src="audioObj ? audioObj.url : ''"                :title="audioObj ? audioObj.name : ''"                :palyIndex="audioIndex"                :details="details"                @audioClick="audioClick"              />            </div>          </div>        </div>        <div v-if="details.videoInfo" class="video-wrap">          <div class="box">            <div class="title">              {{ details.title }}            </div>            <div class="nav" v-if="isShow.includes(channelCode) || channelName.includes(details.channelName)">              <span class="img">                <img src="https://file.daqsoft.com/uploadfile/server/geekui/panda/PC/baseDynamicList/img02.png" alt="" />              </span>              <p class="createCompanyName">{{ details.createCompanyName }}</p>              <span style="font-weight: bold;">・</span>              <p class="time">{{ details.publishTime }}</p>            </div>          </div>          <video :src="details.videoInfo.url" controls :poster="details.videoInfo.imgUrl"></video>        </div>        <!--<div v-if="!details.content && !details.videoInfo && noData" class="text no-data">          <img src="https://file.daqsoft.com/uploadfile/server/geekui/panad/01065f5c-b833-4a97-ad2b-404a2e506fc0.gif" alt="" />        </div>-->        <div v-if="details.annex && details.annex.length">          <a :href="item" v-for="(item, index) in details.annex" :key="index" target="_blank" class="enclosure">{{ getTitle(item)}}</a>        </div>        <div class="crumbs">          <el-breadcrumb separator-class="el-icon-arrow-right">            <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>            <el-breadcrumb-item v-if="crumbsSecond && (crumbsSecond.name || crumbsSecond.title )"><a @click="$router.push(crumbsSecond.url1)">{{ crumbsSecond.name || crumbsSecond.title }}</a></el-breadcrumb-item>            <el-breadcrumb-item v-if="crumbsThird.name !== details.title"><a @click="$router.push(crumbsThird.url1)">{{ crumbsThird.name || crumbsThird.title }}</a></el-breadcrumb-item>            <el-breadcrumb-item>详情</el-breadcrumb-item>          </el-breadcrumb>        </div>      </div>    </div>  </PCLayout></template><script>import AudioBox from '@/components/PCComponents/AudioBox.vue'import { getDetail, channelcrumbs } from '@/service/apiList/common'export default {  name: 'detailsIndex',  components: {    AudioBox  },  data() {    return {      details: {},      noData: false,      isShow: ['jddt', 'djgz'],      channelName: ['科普动态', '熊猫活动', '要闻速递', '失物招领'],      linkSwiperOptions: {        slidesPerView : 4,        spaceBetween : 10,        loop: false,        navigation: {          prevEl: '.btn-left',          nextEl: '.btn-right',        }      },      imgUrl: '',      currentIndex: 0,      audioObj: {},      audioIndex: 0,      crumbsSecond: {},      crumbsThird: {}    }  },  mounted () {    this.getDetail()  },  computed: {    id() {      return this.$route.query.id    },    channelCode() {      return this.$route.query.channelCode    },    detailsComputed () {      let str = this.details.content      let reg = /(\d+)+(?=rem\b)|(\d+\.)\d+(?=rem\b)/g      let arr = str.match(reg)      if(arr && arr.length) {        for(let i = 0; i < arr.length; i++) {          str = str.replace(arr[i] + 'rem', (arr[i] * 50).toFixed() + 'px')        }      }      if(sessionStorage.font === '繁w中文') {        // let arr2 = str.match(/(font-family[^><()"]*(;)?)/g)        // if(arr2) {        //   for(let i = 0; i < arr2.length; i++) {        //     arr2[i] = arr2[i].substring(0, arr2[i].indexOf(';;') + 2)        //     str = str.replace(arr2[i], '')        //   }        // }        str = str.replace(/font-family/g, '') // eslint-disable-line      }      str = str.replace(/\<a/gi, '<a target="_blank"') // eslint-disable-line      return str    },    getUrl() {      return (item) => {        try {          return item.url        } catch (error) {          return this.$Placeholder        }      }    },    getTitle() {      return (title) => {        return title.slice(title.lastIndexOf('/') + 1)      }    },    getName() {      return (name) => {        try {          let newName          if(name.includes('.jpg')) {            newName = name.slice(0, name.indexOf('.jpg'))          }          if(name.includes('.png')) {            newName = name.slice(0, name.indexOf('.png'))          }          if(name.includes('(')) {            newName = name.slice(0, name.indexOf('('))          }          return newName        } catch (error) {          return ''        }      }    }  },  methods: {    getDetail() {      getDetail({ id: this.id }).then(res => {        if (res.code === 0) {          document.title = res.data.title          this.details = res.data          this.imgUrl = this.details.imageUrls[0]          this.audioObj = this.details.audioInfo1 ? this.details.audioInfo1[0] : {}          this.getCrumds()        }      }).finally(() => {        this.noData = true      })    },    imgClick (item, index) {      this.currentIndex = index      this.imgUrl = item    },    audioClick(item, index) {      this.audioObj = item      this.audioIndex = index    },    getQueryString(url) {      let ItemArr = []      let ItemObj = {}      url        .substring(url.lastIndexOf('?') + 1, url.length)        .split('&')        .map((item) => {          ItemArr.push(item.split('='))        })      ItemArr.map((item) => {        ItemObj[item[0]] = item[1]      })      return ItemObj    },    getCrumds() {      let params = this.getQueryString(location.href)      channelcrumbs({        channelCode: params.channelCode      }).then(res => {        this.crumbsSecond = res.data        if(params.channelCode === 'kpjy') {          if(location.href.includes('kpzlk')) {            this.crumbsThird = res.data.subset.filter(item => item.name === '科普资料库')[0]          } else {            this.crumbsThird = res.data.subset.filter(item => item.name === this.details.channelName)[0]          }        } else if (params.channelCode === 'djgz') {          if(location.href.includes('ddjs')) {            this.crumbsThird = res.data.subset.filter(item => item.name === '党的建设')[0]          } else {            this.crumbsThird = res.data.subset.filter(item => item.name === this.details.channelName)[0]          }        } else {          this.crumbsThird = res.data.subset.filter(item => item.name === this.details.channelName)[0]        }      })    }  },  watch: {    $route: {      handler(to) {        if (to.query.id) {          this.getDetail()        }      },      immediate: true,      deep: true,    },  }}</script><style lang="scss" scoped>.content {  padding: 80px 0;  background: #F6F6F6;  .main {    width: 60%;    max-width: 1360px;    min-width: 1200px;    margin: auto;    background: #ffffff;    padding: 60px;    position: relative;  }  .box {    border-bottom: 1px solid #e5e5e5;    margin-bottom: 40px;    padding-bottom: 30px;    .title {      font-weight: Bold;      font-size: 30px;      color: #333333;      border-bottom: 30px;      text-align: center;    }  }  .xmmsg-swiper {    border-bottom: 1px solid #e5e5e5;    margin-bottom: 40px;    padding-bottom: 30px;    position: relative;    .big-picture {      width: 100%;      margin-bottom: 30px;      position: relative;      img {        width: 100%;      }      .name {        width: 100%;        height: 60px;        line-height: 60px;        text-align: center;        background: rgba(0, 0, 0, 0.1);        color: #ffffff;        font-size: 16px;        position: absolute;        bottom: 0;        left: 0;      }    }    .swiper-wrap {      width: 90%;      margin: auto;      position: relative;      .img-wrap {        cursor: pointer;        border: 1px solid transparent;      }      .swiper-button {        position: absolute;        top: 50%;        cursor: pointer;        transform: translateY(-50%);      }      .btn-left {        left: -50px;      }      .btn-right {        right: -50px;      }      .active {        border: 1px solid #333333;      }    }  }  .video {    width: 800px;    margin: auto;    video {      width: 100%;    }  }  .nav {    display: flex;    color: #999999;    font-size: 16px;    align-items: flex-end;    justify-content: center;    margin-top: 30px;    .img {      display: inline-block;      width: 24px;      height: 24px;      border-radius: 50%;      border: 1px solid #E8E8E8;      position: relative;      img {        display: block;        position: absolute;        top: 50%;        left: 50%;        transform: translate(-50%, -50%);        width: 14px;      }    }    .createCompanyName {      margin: 0 10px 0 15px;    }    .time {      margin-left: 10px;    }  }  .no-data {    width: 600px;    margin: auto;    img {      width: 100%;    }  }  .crumbs {    position: absolute;    left: 0;    top: -40px;  }  .video-wrap {    text-align: center;    video {      margin: auto;      width: 100%;      object-fit: cover;    }  }  .enclosure {    color: #0000FF;    display: block;    font-size: 16px;    margin-bottom: 8px;  }}::v-deep .el-breadcrumb__inner a:hover, ::v-deep .el-breadcrumb__inner.is-link:hover {  color: #15A98D;}</style>